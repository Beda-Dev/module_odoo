<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- ============= VUE FOLIO AMÉLIORÉE ============= -->
        <record id="view_hotel_folio_form_accounting" model="ir.ui.view">
            <field name="name">hotel.folio - Comptabilité</field>
            <field name="model">hotel.folio</field>
            <field name="inherit_id">view_hotel_folio_form</field>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='notes']" position="before">
                    <page name="accounting" string="Comptabilité" groups="account.group_account_user">
                        <group string="Statut Facturation">
                            <field name="invoice_status" widget="badge" 
                                   decoration-danger="invoice_status == 'not_invoiced'"
                                   decoration-warning="invoice_status == 'partial'"
                                   decoration-success="invoice_status == 'invoiced'"/>
                            <field name="deposit_credited" readonly="1"/>
                        </group>

                        <group string="Factures">
                            <field name="invoice_ids" readonly="1" nolabel="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="invoice_date"/>
                                    <field name="state" widget="badge"/>
                                    <field name="amount_total" widget="monetary"/>
                                </tree>
                            </field>
                        </group>

                        <group string="Écritures Comptables">
                            <field name="accounting_move_ids" readonly="1" nolabel="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="date"/>
                                    <field name="state" widget="badge"/>
                                </tree>
                            </field>
                            <button name="action_open_accounting_entries" type="object" 
                                    string="Voir Détail" class="oe_link" 
                                    invisible="not accounting_move_ids"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- ============= VUE RÉSERVATION AMÉLIORÉE ============= -->
        <record id="view_hotel_reservation_form_accounting" model="ir.ui.view">
            <field name="name">hotel.reservation - Acompte</field>
            <field name="model">hotel.reservation</field>
            <field name="inherit_id">view_hotel_reservation_form</field>
            <field name="arch" type="xml">
                <xpath expr="//page[@name='notes']" position="after">
                    <page name="accounting" string="Comptabilité" groups="account.group_account_user">
                        <group string="Gestion Acompte">
                            <group>
                                <field name="deposit_amount" widget="monetary"/>
                                <field name="deposit_paid" widget="monetary" readonly="1"/>
                                <field name="deposit_date" readonly="1"/>
                            </group>
                            <group>
                                <button name="action_request_deposit" type="object" 
                                        string="Demander Acompte" class="oe_highlight"
                                        attrs="{'invisible': [('deposit_amount', '&lt;=', 0)]}"/>
                            </group>
                        </group>

                        <group string="Paiements d'Avance">
                            <field name="advance_payment_ids" readonly="1" nolabel="1">
                                <tree>
                                    <field name="date"/>
                                    <field name="amount" widget="monetary"/>
                                    <field name="hotel_payment_method_id"/>
                                    <field name="state" widget="badge"/>
                                </tree>
                            </field>
                        </group>

                        <group string="Écritures Comptables">
                            <field name="accounting_move_ids" readonly="1" nolabel="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="date"/>
                                    <field name="state" widget="badge"/>
                                </tree>
                            </field>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- ============= VUE MODE PAIEMENT AMÉLIORÉE ============= -->
        <record id="view_hotel_payment_method_form_accounting" model="ir.ui.view">
            <field name="name">hotel.payment.method - Comptabilité</field>
            <field name="model">hotel.payment.method</field>
            <field name="inherit_id">view_hotel_payment_method_form</field>
            <field name="arch" type="xml">
                <xpath expr="//group[@string='Configuration']" position="after">
                    <group string="Configuration Comptable" groups="account.group_account_manager">
                        <field name="account_debit_id" 
                               domain="[('deprecated', '=', False), ('account_type', '!=', 'asset_receivable')]"
                               help="Compte où débiter le paiement (ex: Caisse, Banque)"/>
                        <field name="account_credit_id" 
                               domain="[('deprecated', '=', False), ('account_type', '=', 'asset_receivable')]"
                               help="Compte client où créditer le paiement"/>
                    </group>
                </xpath>
            </field>
        </record>

        <!-- ============= VUE PAIEMENT AMÉLIORÉE ============= -->
        <record id="view_account_payment_form_hotel_inherit" model="ir.ui.view">
            <field name="name">account.payment - Hôtel</field>
            <field name="model">account.payment</field>
            <field name="inherit_id">account.view_account_payment_form_legacy</field>
            <field name="arch" type="xml">
                <xpath expr="//sheet" position="after">
                    <div class="alert alert-info" role="alert" 
                         invisible="not reservation_id">
                        <strong>Réservation:</strong> <field name="reservation_id" readonly="1"/>
                        <br/>
                        <strong>Acompte Demandé:</strong> <field name="reservation_id" 
                            attrs="{'invisible': [('reservation_id', '=', False)]}"
                            readonly="1"/>
                    </div>
                </xpath>

                <xpath expr="//notebook" position="inside">
                    <page name="hotel_details" string="Détails Hôtel" 
                          attrs="{'invisible': [('folio_id', '=', False), ('reservation_id', '=', False)]}">
                        <group>
                            <group string="Informations Hôtel">
                                <field name="folio_id" readonly="1"/>
                                <field name="reservation_id" readonly="1"/>
                                <field name="is_advance_payment" readonly="1"/>
                            </group>
                            <group string="Mode de Paiement">
                                <field name="hotel_payment_method_id" readonly="1"/>
                            </group>
                        </group>

                        <group string="Détails Mobile Money" 
                               attrs="{'invisible': [('mobile_phone', '=', False)]}">
                            <field name="mobile_phone" readonly="1"/>
                            <field name="mobile_reference" readonly="1"/>
                        </group>

                        <group string="Détails Chèque" 
                               attrs="{'invisible': [('check_number', '=', False)]}">
                            <field name="check_number" readonly="1"/>
                            <field name="check_date" readonly="1"/>
                            <field name="check_bank" readonly="1"/>
                        </group>
                    </page>
                </xpath>
            </field>
        </record>

        <!-- ============= RAPPORT COMPTABLE ============= -->
        <record id="view_hotel_accounting_report_tree" model="ir.ui.view">
            <field name="name">hotel.accounting.report - Liste</field>
            <field name="model">hotel.accounting.report</field>
            <field name="arch" type="xml">
                <tree string="Rapport Comptable">
                    <field name="folio_id"/>
                    <field name="partner_id"/>
                    <field name="room_id"/>
                    <field name="checkin_date"/>
                    <field name="checkout_date"/>
                    <field name="amount_total" sum="Total"/>
                    <field name="amount_paid" sum="Total Payé"/>
                    <field name="amount_due" sum="Total Dû"/>
                    <field name="invoice_count"/>
                    <field name="state" widget="badge"/>
                </tree>
            </field>
        </record>

        <record id="view_hotel_accounting_report_pivot" model="ir.ui.view">
            <field name="name">hotel.accounting.report - Pivot</field>
            <field name="model">hotel.accounting.report</field>
            <field name="arch" type="xml">
                <pivot string="Rapport Comptable" sample="1">
                    <field name="checkin_date" interval="month" type="row"/>
                    <field name="state" type="col"/>
                    <field name="amount_total" type="measure" aggregation="sum"/>
                    <field name="amount_paid" type="measure" aggregation="sum"/>
                    <field name="amount_due" type="measure" aggregation="sum"/>
                </pivot>
            </field>
        </record>

        <record id="view_hotel_accounting_report_graph" model="ir.ui.view">
            <field name="name">hotel.accounting.report - Graphique</field>
            <field name="model">hotel.accounting.report</field>
            <field name="arch" type="xml">
                <graph string="Revenus par Mois" type="bar" sample="1">
                    <field name="checkin_date" interval="month"/>
                    <field name="amount_total" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- ============= ACTION RAPPORT ============= -->
        <record id="action_hotel_accounting_report" model="ir.actions.act_window">
            <field name="name">Rapport Comptable Hôtel</field>
            <field name="res_model">hotel.accounting.report</field>
            <field name="view_mode">tree,pivot,graph</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Rapport Comptable Hôtel
                </p>
                <p>
                    Analysez vos réservations, factures et paiements en un coup d'œil.
                </p>
            </field>
        </record>

        <!-- ============= MENU ============= -->
        <menuitem id="menu_hotel_accounting_report"
                  name="Rapport Comptable"
                  parent="hotel_management_custom.menu_hotel_accounting"
                  action="action_hotel_accounting_report"
                  sequence="5"
                  groups="account.group_account_user"/>

    </data>
</odoo>