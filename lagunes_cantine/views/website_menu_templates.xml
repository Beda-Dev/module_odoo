<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Template : Affichage du menu -->
    <template id="cantine_menu" name="Menu du jour">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <!-- En-tête avec navigation -->
                <div class="bg-primary text-white py-3">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col">
                                <h3 class="mb-0">
                                    <i class="fa fa-building"/> <t t-esc="entreprise.name"/>
                                </h3>
                            </div>
                            <div class="col-auto">
                                <a href="/cantine/logout" class="btn btn-outline-light btn-sm">
                                    <i class="fa fa-sign-out"/> Déconnexion
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="container mt-4 mb-5">
                    <!-- Navigation par date -->
                    <div class="row mb-4">
                        <div class="col-12 text-center">
                            <h4 class="mb-0 text-primary">
                                <i class="fa fa-calendar-check-o"/> <t t-esc="date_fr"/>
                            </h4>
                        </div>
                    </div>
                    
                    <!-- Affichage du menu -->
                    <t t-if="has_menu">
                        <div class="row">
                            <div class="col-12">
                                <h3 class="mb-4">
                                    <i class="fa fa-cutlery"/> Menu du jour
                                </h3>
                            </div>
                        </div>
                        
                        <div class="row">
                            <t t-foreach="menu.plat_ids" t-as="plat">
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="card h-100 shadow-sm plat-card" t-att-data-plat-id="plat.id">
                                        <t t-if="plat.image_128">
                                            <img t-att-src="'data:image/png;base64,' + plat.image_128.decode('utf-8')" 
                                                 class="card-img-top" 
                                                 alt="Image du plat" 
                                                 style="height: 200px; object-fit: cover;"/>
                                        </t>
                                        <t t-else="">
                                            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                                 style="height: 200px;">
                                                <i class="fa fa-cutlery fa-3x text-muted"/>
                                            </div>
                                        </t>
                                        
                                        <div class="card-body">
                                            <h5 class="card-title" t-field="plat.name"/>
                                            <p class="card-text text-muted" t-if="plat.description" t-field="plat.description"/>
                                            
                                            <t t-if="plat.category_id">
                                                <span class="badge rounded-pill text-bg-secondary mb-2">
                                                    <t t-esc="plat.category_id.name"/>
                                                </span>
                                            </t>
                                            
                                            <div class="mt-3">
                                                <strong class="text-primary">
                                                    <t t-esc="plat.prix_unitaire"/> FCFA
                                                </strong>
                                            </div>
                                            
                                            <!-- Options disponibles (dynamiques) -->
                                            <div class="mt-3" t-if="plat.option_ids">
                                                <small class="fw-bold">Options disponibles:</small>
                                                <t t-foreach="plat.option_ids" t-as="option">
                                                    <div class="form-check">
                                                        <input class="form-check-input plat-option-checkbox" 
                                                               type="checkbox" 
                                                               t-att-value="option.id"
                                                               t-att-id="'opt_' + str(plat.id) + '_' + str(option.id)"/>
                                                        <label class="form-check-label" t-att-for="'opt_' + str(plat.id) + '_' + str(option.id)">
                                                            <t t-esc="option.name"/>
                                                            <t t-if="option.prix_supplementaire > 0">
                                                                (+<t t-esc="option.prix_supplementaire"/> FCFA)
                                                            </t>
                                                        </label>
                                                    </div>
                                                </t>
                                            </div>
                                            
                                            <!-- Quantité (Cachée car fixée à 1) -->
                                            <input type="hidden" class="plat-quantity" value="1"/>
                                            
                                            <!-- Notes -->
                                            <div class="mt-3">
                                                <label class="form-label">Notes spéciales (optionnel)</label>
                                                <textarea class="form-control plat-notes" 
                                                          rows="2" 
                                                          placeholder="Ex: sauce à part..."></textarea>
                                            </div>

                                            <!-- Nom employé (optionnel) -->
                                            <div class="mt-3">
                                                <label class="form-label">Votre nom (optionnel)</label>
                                                <input type="text" class="form-control plat-employee-name" placeholder="Ex: Jean Kouassi"/>
                                            </div>
                                        </div>
                                        
                                        <div class="card-footer bg-white">
                                            <t t-if="not limit_reached">
                                                <button type="button" 
                                                        class="btn btn-primary w-100 btn-commander" 
                                                        t-att-data-plat-id="plat.id"
                                                        t-att-data-menu-id="menu.id"
                                                        t-att-data-entreprise-id="entreprise.id">
                                                    <i class="fa fa-shopping-cart"/> Commander
                                                </button>
                                            </t>
                                            <t t-else="">
                                                <div class="alert alert-success py-2 mb-0 text-center">
                                                    <i class="fa fa-check-circle"/> Commande déjà passée
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </t>
                    
                    <!-- Aucun menu disponible -->
                    <t t-else="">
                        <div class="row">
                            <div class="col-lg-6 offset-lg-3">
                                <div class="alert alert-warning text-center">
                                    <i class="fa fa-exclamation-triangle fa-3x mb-3"/>
                                    <h4>Aucun menu disponible</h4>
                                    <p>Il n'y a pas de menu pour cette date.</p>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
            
            <!-- Script de commande -->
            <script type="text/javascript" src="/lagunes_cantine/static/src/js/lagunes_commande.js"/>
        </t>
    </template>

</odoo>
